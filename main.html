<!DOCTYPE html>
<html>

    <head>

        <link rel="stylesheet" type="text/css" href="main.css">
        <link rel="stylesheet" href="bootstrap-4.0.0-dist/css/bootstrap.min.css">
        <script src="jquery-3.2.1.js"></script>
        <script src="bootstrap-4.0.0-dist/js/bootstrap.min.js"></script>
        <script src="modalJS.js"></script>
		<script src="js/fusioncharts.js"></script>
		<script src="js/fusioncharts.charts.js"></script>
		<script src="js/themes/fusioncharts.theme.zune.js"></script>
		<script src="js/themes/fusioncharts.theme.candy.js"></script>
		<script src="tinysort.js"></script>
        <script src="tinysort.min.js"></script>
		<title>Erbium Project</title>
		<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
        <script>
			var map2;
		var trapArr;
		var trapsWithTemp = [];
		function getallTraps(){
		    return trapArr;
		}
		var clickedTrapLat;
		var clickedTrapLong;
		var intervalArr;
        var testUserDetails;
		var trapArrSortByCaught;//for sorting
			var trapArrSortByTemp = [];
		var trapArrDescriptions = [];
		var allTrapArr;
		var farmLat;
		var farmLong;
		var isAdmin;
            var userObject = {fullName:"", username:"", latitude:0.0, longitude:0.0, admin:0};
            var clientDeviceIdArray= [];
			//test if admin is logged in -> if so then enable admin link

            $(document).ready(function(){
                var userName = "<span class=\"glyphicon glyphicon-user\"></span>";

                //Get traps
                $.get("main.php", function(data, status){
                    console.log("Data: " + data + "\nStatus: " + status);
                    if(status === "success"){
                        trapArr = JSON.parse(data);
                        displayNumOfTraps(trapArr);
                    }
                });
                $(document).ready(function(){
                    $.get("getTraps.php", function(data, status){
                        //console.log("Data: " + data + "\nStatus: " + status);
                        if(status == "success"){
                            allTrapArr = JSON.parse(data);
                            // console.log();
                            //displayNumOfTraps();
                            //displayAllTraps();
                        }
                    });
                });

				var myLat;
				var myLong;

                //Get Name
                var xhrr = new XMLHttpRequest();
                xhrr.onreadystatechange = function() {
                    if (xhrr.readyState == XMLHttpRequest.DONE) {
                        //console.log(xhrr.responseText);
                        testUserDetails = JSON.parse(xhrr.responseText);

                    }
                }
                xhrr.open('GET', 'user_details.php', false);
                xhrr.send(null);
                farmLat = testUserDetails[2];
                farmLong = testUserDetails[3];
                isAdmin = testUserDetails[4];
				document.getElementById("userlat").value = farmLat;
                $.get("user_details.php", function(data, status){
                    console.log("User data: ")
                    console.log(data);
                    if(status === "success"){
                        data = JSON.parse(data);
                        userObject.fullName = data[0];
                        userObject.username = data[1];
                        userObject.latitude = data[2];
                        userObject.longitude = data[3];
                        userObject.admin = data[4];
                        myLat = userObject.latitude;
                        myLong = userObject.longitude;
                        document.getElementById("user_name").innerHTML = userName+'&nbsp;'+userObject.fullName;
                    }else{
                        document.getElementById("user_name").innerHTML = userName+"&nbsp;Undefined";

                    }
                });


                // document.getElementById('trapButton').click();
                /*$('#logout').click(function(){

                });*/
            });
        function getLat(){
            return farmLat;
        }
            //trap management
            var numOfTraps = 0;
		var tempHumid = 0;
		var tempTemp = 0;
		const arrayForHumid=[];
		var arrayForTemp=[];
        var temp;
        let humid;

        function getHumid(id){//,callback){
            var element = 0;
            $.ajax({
                type: 'post',
                url: 'getHumidAverage.php',
                async:false,
                data: "device_id="+ id,
                dataType: 'json',
                success: function(response) {
                    /*var content = response;
                    element = content;

                    callback(element);*/
                    //AjaxCallBackHumid(response);
                    //alert(tempHumid);
                    arrayForHumid.push(id,response);
                    console.log(arrayForHumid);
                }
            });
        }
        function getTemp(id){
            var element = 0;
            $.ajax({
                type: 'post',
                url: 'getTempAverage.php',
                async:false,
                data: "device_id="+ id,
                dataType: 'json',
                success: function(response) {
                    /*var content = response;
                    element = content;

                    callback(element);*/
                    //AjaxCallBackHumid(response);
                    //alert(tempHumid);
                    arrayForTemp.push(id,response);
                }
            });
        }
            function displayNumOfTraps(array)
            {
                //console.log(intervalArr);
                //console.log(arrayForHumid);
                trapArrSortByCaught = array;
                for(i=0;i<array.length;i++)
                                {
                                    trapArrDescriptions.push(array[i][8]);
                                    var temp,humid;
                                    var xhr = new XMLHttpRequest();
                                    xhr.open('POST', 'getTempAverage.php', false);
                                    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                                    xhr.onload = function () {
                                        // do something to response
                                        console.log(this.responseText);
                                        temp = this.responseText;
                                    };
                                    xhr.send('device_id=' + array[i][5]);
                                    var xhr2 = new XMLHttpRequest();
                                    xhr2.open('POST', 'getHumidAverage.php', false);
                                    xhr2.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                                    xhr2.onload = function () {
                                        // do something to response
                                        console.log(this.responseText);
                                        humid = this.responseText;
                                    };
                                    xhr2.send('device_id=' + array[i][5]);
                                    let id = array[i][5];
                                    let hid = array[i][0];
                                    let c = array[i][1];
                                    let t = array[i][2];
                                    let u = array[i][3];
                                    let b = array[i][4];
                                    let lat = array[i][6];
                                    let long = array[i][7];
                                    let descrip = array[i][8];
                                    let signal = array[i][9];
                                    let lastUp = array[i][10];
                                    let dataAv = array[i][11];
                                    let avrTemp = temp;
                                    let avrHum = humid;
                                    //trapsWithTemp.push(hid, c, t, u,b,avrHum,avrTemp,id,lat,long,descrip,signal,lastUp,dataAv);
                                    addTrapDiv(hid, c, t, u,b,id,lat,long,descrip,signal,lastUp,dataAv,avrHum,avrTemp);
                                    clientDeviceIdArray.push(id);
                                    trapArrSortByTemp[i] = new Array(hid, c, t, u,b,avrHum,avrTemp,id,lat,long,descrip,signal,lastUp,dataAv);
                                    trapArrSortByTemp[i] = new Array(hid,c,t,u,b,id,lat,long,descrip,signal,lastUp,dataAv,avrHum,avrTemp);
                                    numOfTraps++;
                                    }
                document.getElementById("trapNo").innerHTML = "The number of traps atm is: " + numOfTraps;
            }
			console.log(trapArrSortByTemp);
		    var no=0;
            function addTrapDiv(tempName,caught,type,upload,battery,id,latitude,longitude,description,sig,lastU,dataA,averageHumid,averageTemp)
            {
                  no++;
                //alert(averageHumid);
                var name = tempName;
                var TrapType = type;
                var UploadInt = upload;
                var bat_perc = battery;
                var tempHumid = averageHumid;
                var tempTemp = averageTemp;
                var lat = latitude;
                var long = longitude;
                var desc = description;
                var signal = sig;
                var last_updated = lastU;
                var data_available = dataA;
                // numOfTraps++;
                //var tempName = prompt("Please enter a temp name for testing","");
                var iDiv = document.createElement('div');
                    iDiv.id = tempName;
                    iDiv.className = "trap";
                    iDiv.name = no;
                    iDiv.onclick = function(){

                        /*var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(lat, long),
                            map: map2
                        });*/
                        myMap2(lat,long);
                        document.getElementById("editDescription").value = description;
                        document.getElementById("upload_interval").value = UploadInt;
                        document.getElementById("editType").value = TrapType;
                        document.getElementById("Tid").value = name;
                        document.getElementById("lblLat").value = lat;
                        document.getElementById("lblLong").value = long;
                        document.getElementById("showToken").value = name;
                        document.getElementById("showDescription").value = description;
                        document.getElementById("showTrapGroup").value= TrapType;
                        document.getElementById("showUpload").value = UploadInt;
                        document.getElementById("showCaught").value = caught;
                        document.getElementById("showBattery").value = bat_perc;
                        document.getElementById("showSignal").value = signal;
                        document.getElementById("showLastUpdate").value = last_updated;
                        document.getElementById("showData").value = data_available;
                        document.getElementById("showLat").value = lat;
                        document.getElementById("showLong").value = long;
                        showTrapMap(name,lat,long);
                    }
                var clickMe = document.createElement("button");
                    clickMe.innerHTML = "";
                    clickMe.id = "editTButton";
				var showMore = document.createElement("button");
					showMore.innerHTML = "More";
					showMore.id = "showMoreButton";
					showMore.style.position = "relative";
					showMore.style.top = "0";
                var deleteTrap = document.createElement("button");
                deleteTrap.innerHTML = "Delete";
                deleteTrap.id = "deleteTrap";
                deleteTrap.onclick = function() {

                    $.get("deleteTrap.php", {token:tempName}, function(data, status){
                        console.log("Removed:"+status);
                        // if(data !== ""){
                        alert(data);
                        // }
                    });
                    window.location.reload(false);
                };
                var tempLbl = document.createElement("label");
                    tempLbl.innerHTML = "<br> Temp avr 24hr: <br>";
                var humidLbl = document.createElement("label");
                    humidLbl.innerHTML = "Humid avr 24hr: <br>";
                var device_bat = document.createElement("label");
                device_bat.innerHTML = "Battery: " + bat_perc + "%" + "<br>";

					if(bat_perc < 50 && bat_perc >= 30){
						device_bat.style.color = "yellow";
					}
					else if(bat_perc < 30){
						device_bat.style.color = "red";
					}
					else{
						device_bat.style.color = "green";
					}

                var tempText = document.createElement("input");
					tempText.type = "text";
					tempText.id = "tempText";
					tempText.value = averageTemp;
					tempText.style.width = "50px";
					tempText.style.color = "green";
					tempText.style.backgroundColor = "rgba(0,0,0,0)";
					tempText.style.outline = "none";
					tempText.style.border = "none";
                var humidText = document.createElement("input");
					humidText.type = "text";
					humidText.id = "humidText";
					humidText.value = averageHumid;
					humidText.style.width = "50px";
					humidText.style.color = "green";
					humidText.style.backgroundColor = "rgba(0,0,0,0)";
					humidText.style.outline = "none";
					humidText.style.border = "none";
                var tokenText = document.createElement("header");
					tokenText.innerHTML = "Caught: " + caught;
					tokenText.style.fontSize = "30px";


                var iHeader = document.createElement('header');
                iHeader.innerHTML = "Desc: " + description;

                iDiv.appendChild(iHeader);
                iDiv.appendChild(clickMe);
                iDiv.appendChild(deleteTrap);
                iDiv.appendChild(showMore);
                iDiv.appendChild(tokenText);
                iDiv.appendChild(tempLbl);
                iDiv.appendChild(tempText);
                iDiv.appendChild(humidLbl);
                iDiv.appendChild(humidText);
                iDiv.appendChild(device_bat);
                document.getElementById("trapsDisplay").appendChild(iDiv);
            }
        console.log(trapArrDescriptions);
            //for the tab
            function openCity(evt, cityName) {
                // Declare all variables
                var i, tabcontent, tablinks;

                // Get all elements with class="tabcontent" and hide them
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }

                // Get all elements with class="tablinks" and remove the class "active"
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace("active", "");
                }

                // Show the current tab, and add an "active" class to the button that opened the tab
                document.getElementById(cityName).style.display = "block";
                evt.currentTarget.className += " active";
            }

            function addTrap(){
                document.getElementById("modal2").style.visibility = "visible";
            }
            function displayGraphs(){
                document.getElementById("Traps").style.display = "none";
                document.getElementById("Graphs").style.display = "block";
                document.getElementById("Admin").style.display = "none";
            }
            function displayTraps(){
                document.getElementById("Traps").style.display = "block";
                document.getElementById("Graphs").style.display = "none";
                document.getElementById("Admin").style.display = "none";
            }
            function displayAdmin(){
                document.getElementById("Traps").style.display = "none";
                document.getElementById("Graphs").style.display = "none";
                document.getElementById("Admin").style.display = "block";
            }
			function enterAddTrap(e, textarea){
				var code = (e.keyCode ? e.keyCode : e.which);
				if(code == 13) { //Enter keycode
					document.getElementById("addTrapButton").click();
				}
			}
			function enterEditTrap(e, textarea){
				var code = (e.keyCode ? e.keyCode : e.which);
				if(code == 13) { //Enter keycode
					document.getElementById("editTrapButton").click();
				}
			}
			$(document).ready(function(){
				$("#trapAddButton").click(function(){
					$("#addTrapModal").modal('show');
				});

			});
			$(document).ready(function(){
				$(document).on('click', "#editTButton", function() {
					$("#editTrapModal").modal('show');
				});

			});
			$(document).ready(function(){
				$(document).on('click', "#showMoreButton", function() {
					$("#showMoreModal").modal('show');
				});

			});
			$(document).ready(function(){
				$(document).on('click', "#mapofTrapsClient", function() {
					$("#allTrapsMapModal").modal('show');
				});

			});
            function validateAddClient(){
                var pw1 = document.getElementById("pw1").value;
                var pw2 = document.getElementById("pw2").value;
                if(pw1=="" || pw2 == ""){
                    alert("Please enter a password");
                    preventDefault();
                }
                else if(pw1 != pw2){
                    alert("Please make sure the passwords match");
                    return false;
                }
                else
                    document.getElementById("clientForm").submit();
            }
            function EditModalClose(){
                var element = document.getElementById("editTrapModal");
                element.parentNode.removeChild(element);

			}

            function makeGraphs(){
                var chartData1;
                var chartData2;
                var chartData3;
                $.get("getGraphInfo.php", function(data, status){
                    console.log("Data: " + data + "\nStatus: " + status);
                    if(status === "success"){
                        chartData1 = JSON.parse(data);
                        var chartProperties1 = {
                            "caption": "Number of moths caught in traps",
                            "xAxisName": "Token",
                            "yAxisName": "Caught",
                            "rotatevalues": "1",
                            "theme": "zune"
                        };
                        Chart1 = new FusionCharts({
                            type: 'column2d',
                            renderAt: 'MothsCaughtColumn',
                            width: '550',
                            height: '350',
                            dataFormat: 'json',
                            dataSource: {
                                "chart": chartProperties1,
                                "data": chartData1
                            }
                        });
                        Chart1.render();
                    }
                });
				mothsPerDay(0);
                tempPerDay(30);
			}
			function mothsPerDay(inter){
                function sameDay(d1, d2) {
                    return d1.getFullYear() === d2.getFullYear() &&
                        d1.getMonth() === d2.getMonth() &&
                        d1.getDate() === d2.getDate();
                }
                function sameMonth(d1, d2) {
                    return d1.getFullYear() === d2.getFullYear() &&
                        d1.getMonth() === d2.getMonth();
                }
                function sameYear(d1, d2) {
                    return d1.getFullYear() === d2.getFullYear();
                }
                function threeMonths(d1,d2){
                    return d1 > d2;
				}
                function sixMonths(d1,d2){
                    return d1 > d2;
                }
                function threeYears(d1,d2){
                    return d1 > d2;
				}
				if(inter === 30){
                    const chartData3 = [
                        {
                            "label": "27-08-2018 00:00:00",
                            "value": "5"
                        },
                        {
                            "label": "27-10-2018 08:12:56",
                            "value": "8"
                        },
                        {
                            "label": "27-11-2018 13:12:22",
                            "value": "3"
                        },
                        {
                            "label": "30-11-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "01-11-2018 16:02:00",
                            "value": "12"
                        },
                        {
                            "label": "05-11-2018 16:02:00",
                            "value": "19"
                        },
                        {
                            "label": "03-12-2018 16:02:00",
                            "value": "2"
                        },
                        {
                            "label": "04-12-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "05-12-2018 16:02:00",
                            "value": "11"
                        },
                    ]
					var newChartData3 =[];
                    var q = new Date();
                    Object.keys(chartData3).forEach(function(key) {
                        //console.log(key, chartData3[key],chartData3[key].label);
                        var readableDate = chartData3[key].label.substring(3,6) + chartData3[key].label.substring(0,2)
                            + chartData3[key].label.substring(5,chartData3[key].label.length);
                        //console.log(new Date(readableDate));
                        var tDate = new Date(readableDate);
                        //console.log("today: ", q);
                        if(!sameMonth(tDate,q)){
                            //alert(tDate);
                            //console.log(chartData3[2]);
							delete chartData3[key];
                        }
                    });
                    console.log(chartData3);
                    var chartProperties3 = {
                        "caption": "Caught over the last month",
                        "xAxisName": "Time stamp",
                        "yAxisName": "Caught",
                        "rotatevalues": "1",
                        "theme": "zune"
                    };
                    Chart3 = new FusionCharts({
                        type: 'line',
                        renderAt: 'lineperday',
                        width: '550',
                        height: '350',
                        dataFormat: 'json',
                        dataSource: {
                            "chart": chartProperties3,
                            "data": chartData3
                        }
                    });
                    Chart3.render();
				}
				else if(inter === 3){
                    const chartData3 = [
                        {
                            "label": "27-08-2018 00:00:00",
                            "value": "5"
                        },
                        {
                            "label": "27-10-2018 08:12:56",
                            "value": "8"
                        },
                        {
                            "label": "27-11-2018 13:12:22",
                            "value": "3"
                        },
                        {
                            "label": "30-11-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "01-11-2018 16:02:00",
                            "value": "12"
                        },
                        {
                            "label": "05-11-2018 16:02:00",
                            "value": "19"
                        },
                        {
                            "label": "03-12-2018 16:02:00",
                            "value": "2"
                        },
                        {
                            "label": "04-12-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "05-12-2018 16:02:00",
                            "value": "11"
                        },
                    ]
                    var q = new Date();
                    q.setMonth(q.getMonth() - 3);
                    Object.keys(chartData3).forEach(function(key) {
                        //console.log(key, chartData3[key],chartData3[key].label);
                        var readableDate = chartData3[key].label.substring(3,6) + chartData3[key].label.substring(0,2)
                            + chartData3[key].label.substring(5,chartData3[key].label.length);
                        //console.log(new Date(readableDate));
                        var tDate = new Date(readableDate);
                        //console.log("today: ", q);
                        if(!threeMonths(tDate,q)){
                            //alert(tDate);
                            //console.log(chartData3[2]);
                            delete chartData3[key];
                        }
                    });
                    console.log(chartData3);
                    var chartProperties3 = {
                        "caption": "Caught over a the last 3 months",
                        "xAxisName": "Time stamp",
                        "yAxisName": "Caught",
                        "rotatevalues": "1",
                        "theme": "zune"
                    };
                    Chart3 = new FusionCharts({
                        type: 'line',
                        renderAt: 'lineperday',
                        width: '550',
                        height: '350',
                        dataFormat: 'json',
                        dataSource: {
                            "chart": chartProperties3,
                            "data": chartData3
                        }
                    });
                    Chart3.render();
				}
                else if(inter === 6){
                    const chartData3 = [
                        {
                            "label": "27-08-2018 00:00:00",
                            "value": "5"
                        },
                        {
                            "label": "27-10-2018 08:12:56",
                            "value": "8"
                        },
                        {
                            "label": "27-11-2018 13:12:22",
                            "value": "3"
                        },
                        {
                            "label": "30-11-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "01-11-2018 16:02:00",
                            "value": "12"
                        },
                        {
                            "label": "05-11-2018 16:02:00",
                            "value": "19"
                        },
                        {
                            "label": "03-12-2018 16:02:00",
                            "value": "2"
                        },
                        {
                            "label": "04-12-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "05-12-2018 16:02:00",
                            "value": "11"
                        },
                    ]
                    var q = new Date();
                    q.setMonth(q.getMonth() - 6);
                    Object.keys(chartData3).forEach(function(key) {
                        //console.log(key, chartData3[key],chartData3[key].label);
                        var readableDate = chartData3[key].label.substring(3,6) + chartData3[key].label.substring(0,2)
                            + chartData3[key].label.substring(5,chartData3[key].label.length);
                        //console.log(new Date(readableDate));
                        var tDate = new Date(readableDate);
                        //console.log("today: ", q);
                        if(!threeMonths(tDate,q)){
                            //alert(tDate);
                            //console.log(chartData3[2]);
                            delete chartData3[key];
                        }
                    });
                    console.log(chartData3);
                    var chartProperties3 = {
                        "caption": "Caught over the last 6 months",
                        "xAxisName": "Time stamp",
                        "yAxisName": "Caught",
                        "rotatevalues": "1",
                        "theme": "zune"
                    };
                    Chart3 = new FusionCharts({
                        type: 'line',
                        renderAt: 'lineperday',
                        width: '550',
                        height: '350',
                        dataFormat: 'json',
                        dataSource: {
                            "chart": chartProperties3,
                            "data": chartData3
                        }
                    });
                    Chart3.render();
                }
                else if(inter === 365){
                    const chartData3 = [
                        {
                            "label": "27-08-2018 00:00:00",
                            "value": "5"
                        },
                        {
                            "label": "27-10-2018 08:12:56",
                            "value": "8"
                        },
                        {
                            "label": "27-11-2018 13:12:22",
                            "value": "3"
                        },
                        {
                            "label": "30-11-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "01-11-2018 16:02:00",
                            "value": "12"
                        },
                        {
                            "label": "05-11-2018 16:02:00",
                            "value": "19"
                        },
                        {
                            "label": "03-12-2018 16:02:00",
                            "value": "2"
                        },
                        {
                            "label": "04-12-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "05-12-2018 16:02:00",
                            "value": "11"
                        },
                    ]
                    var q = new Date();
                    Object.keys(chartData3).forEach(function(key) {
                        //console.log(key, chartData3[key],chartData3[key].label);
                        var readableDate = chartData3[key].label.substring(3,6) + chartData3[key].label.substring(0,2)
                            + chartData3[key].label.substring(5,chartData3[key].label.length);
                        //console.log(new Date(readableDate));
                        var tDate = new Date(readableDate);
                        //console.log("today: ", q);
                        if(!sameYear(tDate,q)){
                            //alert(tDate);
                            //console.log(chartData3[2]);
                            delete chartData3[key];
                        }
                    });
                    console.log(chartData3);
                    var chartProperties3 = {
                        "caption": "Caught over the last year",
                        "xAxisName": "Time stamp",
                        "yAxisName": "Caught",
                        "rotatevalues": "1",
                        "theme": "zune"
                    };
                    Chart3 = new FusionCharts({
                        type: 'line',
                        renderAt: 'lineperday',
                        width: '550',
                        height: '350',
                        dataFormat: 'json',
                        dataSource: {
                            "chart": chartProperties3,
                            "data": chartData3
                        }
                    });
                    Chart3.render();
                }
                else if(inter === 1095){
                    const chartData3 = [
                        {
                            "label": "27-08-2011 00:00:00",
                            "value": "5",
                        },
                        {
                            "label": "27-10-2018 08:12:56",
                            "value": "8"
                        },
                        {
                            "label": "27-11-2018 13:12:22",
                            "value": "3"
                        },
                        {
                            "label": "30-11-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "01-11-2018 16:02:00",
                            "value": "12"
                        },
                        {
                            "label": "05-11-2018 16:02:00",
                            "value": "19"
                        },
                        {
                            "label": "03-12-2018 16:02:00",
                            "value": "2"
                        },
                        {
                            "label": "04-12-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "05-12-2018 16:02:00",
                            "value": "11"
                        },
                    ]
                    var q = new Date();
                    q.setFullYear(q.getFullYear()-3);
                    Object.keys(chartData3).forEach(function(key) {
                        var readableDate = chartData3[key].label.substring(3,6) + chartData3[key].label.substring(0,2)
                            + chartData3[key].label.substring(5,chartData3[key].label.length);
                        //console.log(new Date(readableDate));
                        var tDate = new Date(readableDate);
                        //console.log("today: ", q);
                        if(!threeYears(tDate,q)){
                            //alert(tDate);
                            //console.log(chartData3[2]);
                            delete chartData3[key];
                        }
                    });
                    console.log(chartData3);
                    var chartProperties3 = {
                        "caption": "Caught over the last 3 years",
                        "xAxisName": "Time stamp",
                        "yAxisName": "Caught",
                        "rotatevalues": "1",
                        "theme": "zune"
                    };
                    Chart3 = new FusionCharts({
                        type: 'line',
                        renderAt: 'lineperday',
                        width: '550',
                        height: '350',
                        dataFormat: 'json',
                        dataSource: {
                            "chart": chartProperties3,
                            "data": chartData3
                        }
                    });
                    Chart3.render();
				}
                else if(inter === 0){
                   // for(i=0;i<=clientDeviceIdArray.length;i++){

                        /*var element = 0;
                        $.ajax({
                            type: 'post',
                            url: 'getGraphInfoTrapCount.php',
                            data: "device_id="+ clientDeviceIdArray[i],
                            dataType: 'json',
                            success: function(response) {
                                var content = response;
                                element = content;
                                //MAKE GRAPH HERE AS SOON AS BACKEND IS DONE!!!!
                            }
                        });*/
                    const chartData3 = [
                        {
                            "label": "27-08-2018 00:00:00",
                            "value": "5"
                        },
                        {
                            "label": "27-10-2018 08:12:56",
                            "value": "8"
                        },
                        {
                            "label": "27-11-2018 13:12:22",
                            "value": "3"
                        },
                        {
                            "label": "30-11-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "01-11-2018 16:02:00",
                            "value": "12"
                        },
                        {
                            "label": "05-11-2018 16:02:00",
                            "value": "19"
                        },
                        {
                            "label": "03-12-2018 16:02:00",
                            "value": "2"
                        },
                        {
                            "label": "04-12-2018 16:02:00",
                            "value": "7"
                        },
                        {
                            "label": "05-12-2018 16:02:00",
                            "value": "11"
                        },
                    ]
                        var chartProperties3 = {
                            "caption": "Caught overall",
                            "xAxisName": "Time stamp",
                            "yAxisName": "Caught",
                            "rotatevalues": "1",
                            "theme": "zune"
                        };
                        Chart3 = new FusionCharts({
                            type: 'line',
                            renderAt: 'lineperday',
                            width: '550',
                            height: '350',
                            dataFormat: 'json',
                            dataSource: {
                                "chart": chartProperties3,
                                "data": chartData3
                            }
                        });
                        Chart3.render();
                   // }
				}


			}
			function tempPerDay(inter){
                var chartData4;
                //willbe able to post device ids to get data from php file
                if(inter === 0){
                    /*$.get("getIntervalsCaught.php", function(data, status){
                        console.log("Data: " + data + "\nStatus: " + status);
                        if(status === "success"){
                            chartData4 = JSON.parse(data);
                            var chartProperties1 = {
                                "caption": "Temperature per trap over a period",
                                "yaxisname": "Temperature",
                                "showhovereffect": "1",
                                "rotateNames": "1",
                                "numbersuffix": "",
                                "drawcrossline": "1",
                                "plottooltext": "<b>$dataValue</b> of youth were on $seriesName",
                                "theme": "candy"
                            };
                            Chart1 = new FusionCharts({
                                type: 'msline',
                                renderAt: 'tempPerDayChart',
                                width: '550',
                                height: '350',
                                dataFormat: 'json',
                                dataSource: {
                                    "chart": chartProperties1,
                                    "data": chartData4
                                }
                            });
                            Chart1.render();
                        }
                    });*/
                }
                else if(inter === 30){
                    const dataSource = {
                        "chart": {
                            "caption": "Temperature per trap over a period",
                            "yaxisname": "Temperature",
                            "showhovereffect": "1",
							"rotateNames": "1",
                            "numbersuffix": "",
                            "drawcrossline": "1",
                            "plottooltext": "<b>$dataValue</b> of youth were on $seriesName",
                            "theme": "candy"
                        },

                        "categories": [
                            {
                                "category": [
                                    {
                                        "label": "05-11-2018 16:02:00"
                                    },
                                    {
                                        "label": "11-11-2018 16:02:00"
                                    },
                                    {
                                        "label": "21-11-2018 16:02:00"
                                    },
                                    {
                                        "label": "2-12-2018 16:02:00"
                                    },
                                    {
                                        "label": "04-12-2018 16:02:00"
                                    }
                                ]
                            }
                        ],
                        "dataset": [
                            {
                                "seriesname": "Waterpump",
                                "data": [
                                    {
                                        "value": "62"
                                    },
                                    {
                                        "value": "64"
                                    },
                                    {
                                        "value": "64"
                                    },
                                    {
                                        "value": "66"
                                    },
                                    {
                                        "value": "78"
                                    }
                                ]
                            },
                            {
                                "seriesname": "Pump2",
                                "data": [
                                    {
                                        "value": "16"
                                    },
                                    {
                                        "value": "28"
                                    },
                                    {
                                        "value": "34"
                                    },
                                    {
                                        "value": "42"
                                    },
                                    {
                                        "value": "54"
                                    }
                                ]
                            },
                            {
                                "seriesname": "By die deur",
                                "data": [
                                    {
                                        "value": "20"
                                    },
                                    {
                                        "value": "22"
                                    },
                                    {
                                        "value": "27"
                                    },
                                    {
                                        "value": "22"
                                    },
                                    {
                                        "value": "29"
                                    }
                                ]
                            },
                            {
                                "seriesname": "Behind house",
                                "data": [
                                    {
                                        "value": "18"
                                    },
                                    {
                                        "value": "19"
                                    },
                                    {
                                        "value": "21"
                                    },
                                    {
                                        "value": "21"
                                    },
                                    {
                                        "value": "24"
                                    }
                                ]
                            }
                        ]
                    };

                    FusionCharts.ready(function() {
                        var myChart = new FusionCharts({
                            type: "msline",
                            renderAt: "tempPerDayChart",
                            width: "550",
                            height: "350",
                            dataFormat: "json",
                            dataSource
                        }).render();
                    });
                }
                else if(inter === 3){

                }
                else if(inter === 6){

                }
                else if(inter === 365){

                }
                else if(inter === 1095){

                }
			}
			function cumMothsGraph(){

			}
			function mothsPerDaySelect(){
                if(document.getElementById("mothsPerDay").selectedIndex === 0){
					mothsPerDay(0);
				}
                else if(document.getElementById("mothsPerDay").selectedIndex === 1){
					mothsPerDay(30);
                }
                else if(document.getElementById("mothsPerDay").selectedIndex === 2){
					mothsPerDay(3)
                }
                else if(document.getElementById("mothsPerDay").selectedIndex === 3){
					mothsPerDay(6)
                }
                else if(document.getElementById("mothsPerDay").selectedIndex === 4){
                    mothsPerDay(365)
                }
                else if(document.getElementById("mothsPerDay").selectedIndex === 5){
                    mothsPerDay(1095)
                }
			}
        function tempPerDaySelect(){
            if(document.getElementById("mothsPerDay").selectedIndex === 0){
                tempPerDay(0);
            }
            else if(document.getElementById("mothsPerDay").selectedIndex === 1){
                tempPerDay(30);
            }
            else if(document.getElementById("mothsPerDay").selectedIndex === 2){
                tempPerDay(3)
            }
            else if(document.getElementById("mothsPerDay").selectedIndex === 3){
                tempPerDay(6)
            }
            else if(document.getElementById("mothsPerDay").selectedIndex === 4){
                tempPerDay(365)
            }
            else if(document.getElementById("mothsPerDay").selectedIndex === 5){
                tempPerDay(1095)
            }
        }
			var OptionClicked;
			function setSortDropDown(){
			    //alert(farmLat);
                if(isAdmin === "1"){
                   // alert("asd");
					//document.getElementById("linkToAdmin").style.visibility = 'hidden';
                    var ul = document.getElementById("mainList");
                    var li = document.createElement("li");
                    li.className = "nav-item";
                    li.id= "linkToAdmin";
                    var link = document.createElement("a");
                    link.appendChild(document.createTextNode("Admin"));
                    link.className = "nav-link";
                    link.href = "adminOptions.html";
                    ul.appendChild(li);
                    li.appendChild(link);
                }
				else {

				}
                var eSelect = document.getElementById('sortDropdown');
                var maintrapdiv = document.getElementById("trapsDisplay");
                var tempArr=[];
                for(i=0;i<trapArrSortByCaught.length;i++){
                    tempArr.push(trapArrSortByCaught[i][2]);
				}
                var uniqueGroupsSet = new Set(tempArr);
                var uniqueGroupsForClient = Array.from(uniqueGroupsSet);
                var select = document.getElementById("sortDropdown");
                for(j=0;j<uniqueGroupsForClient.length;j++){
					var newSelect = document.createElement('option');
					newSelect.innerHTML = uniqueGroupsForClient[j];
                    newSelect.value = uniqueGroupsForClient[j];
                    select.appendChild(newSelect);
				}
                var text = eSelect.options[eSelect.selectedIndex].text;
                //var tempA = [];
                var tempA = trapArr;
                var tempB = trapArrSortByTemp;
                eSelect.onchange = function() {
                    if(eSelect.selectedIndex === 1) {
                        tempA.sort(function(a, b) {
                            return b[1] - a[1];
                        });
                        maintrapdiv.innerHTML = '';//delete child elements on div
						numOfTraps = 0;
                        displayNumOfTraps(tempA);
                    } else if(eSelect.selectedIndex === 2){
						//battery?
                        tempA.sort(function(a, b) {
                            return b[4] - a[4];
                        });
                        maintrapdiv.innerHTML = '';//delete child elements on div
                        numOfTraps = 0;
                        displayNumOfTraps(tempA);
                    }
                    else if(eSelect.selectedIndex === 3){
                        //SORT BY TEMP
                        tempB.sort(function(a, b) {
                            return b[13] - a[13];
                        });
                        maintrapdiv.innerHTML = '';//delete child elements on div
                        numOfTraps = 0;
                        displayNumOfTraps(tempB);
					}
					else{
                        const counter = trapArr.length;
                        var sel = document.getElementById("sortDropdown").value;
                        const newArr = [];
                        for(j=0;j<counter;j++){
                            const t = trapArr;
                            if(t[j][2] === sel){
                                newArr.push(t[j]);
                            }
                        }
                        console.log(newArr);
                        console.log(counter);
                        maintrapdiv.innerHTML = '';//delete child elements on div
                        numOfTraps = 0;
                        displayNumOfTraps(newArr);
					}
                }
			}
        var t;
        $.get("getTraps.php", function(data, status){
            //console.log("Data: " + data + "\nStatus: " + status);
            if(status === "success"){
                t = JSON.parse(data);
            }
        });
        function allTraps() {
			    //var t = document.getElementById("userlat").valuel
			    //alert(t);
            // myMap();
			//alert(userObject.longitude);
            //Also store the farm location to be the centre point
			const allLocations = [];
			const individualLocations = [];
            console.log(t);
            for(i=0;i<t.length;i++){
				allLocations[i] = new Array(t[i][2],t[i][7],t[i][8]);
			}
			console.log(allLocations);
			function addLocation(name,lat,long){
			}

            //console.log(allLocations);
            var allTrapLocations = allLocations;//to hold trap locations for user
            //alert(userObject.latitude);
            var map = new google.maps.Map(document.getElementById('allTrapsGoogleMap'), {
                zoom: 13,
                center: new google.maps.LatLng(-25.758972931872734,28.231539476196303),
                mapTypeId: google.maps.MapTypeId.SATELLITE
            });

            var infowindow = new google.maps.InfoWindow();

            var marker, i;

            for (i = 0; i < allTrapLocations.length; i++) {
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(allTrapLocations[i][1], allTrapLocations[i][2]),
                    map: map
                });

                google.maps.event.addListener(marker, 'click', (function (marker, i) {
                    return function () {
                        infowindow.setContent(allTrapLocations[i][0]);
                        infowindow.open(map, marker);
                    }
                })(marker, i));
            }
        }
        //tinysort('#trapsDisplay > div',{attr: 'name'});
            //-----------------------------------------------------------------
		function validateNewEmail(){
			    if(document.getElementById("newEmail1").value != document.getElementById("newEmail2").value){
			        alert("The email you entered does not match.");
				}
				else{
				    document.getElementById("newEmailForm").submit();
				    alert("Email has been changed");
				}
		}
		function validateNewUpload(){
			    if(document.getElementById("newUploadInterval").selectedIndex === 0){
			        alert("Please select a new upload interval first");
				}
				else {
				    document.getElementById("newUploadForm").submit();
				    alert("Upload interval has been changed for all traps");
				}
		}
		function validateNewDefaultLocation(){
			    if(document.getElementById("lblDefaultLat").value === "" || document.getElementById("lblDefaultLong").value === ""){
			        alert("Please select a new location first");
				}
				else{
				    document.getElementById("newDefaultLocationForm").submit();
				    alert("Default location changed");
				}
		}
        </script>
    </head>


    <body onload="setSortDropDown();openCity(event, 'Traps')">
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<a class="navbar-brand" href="main.html">Erbium Insect Tracker </a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav" id="mainList">

					<li class="nav-item">
						<a class="nav-link" href="contactus.html">Contact Us</a>
					</li>
					<!--<li class="nav-item" id="linkToAdmin">
						<a class="nav-link" href="adminOptions.html" id="adminLink">Admin</a>
					</li>-->
				</ul>
				<ul class="navbar-nav ml-auto">
					<p id="user_name"></p>
					<li class="nav-item">
						<a class="nav-link" href="logout.php" id="Out">Logout</a>
					</li>
				</ul>

			</div>
		</nav>
        <!-- Tab links openCity(event, 'Traps') -->
		<div class="tab">
			<button class="tablinks" id="trapTab" onclick="openCity(event, 'Traps')">Traps</button>
			<button class="tablinks" onclick="openCity(event, 'Graphs');makeGraphs()">Graphs</button>
			<button class="tablinks" onclick="openCity(event, 'Settings')">Settings</button>
		</div>

		<div id="Settings" class="tabcontent" style="background-color:rgba(0,0,0,0.5);height:1000px;color:white;">
			<h2 style="text-align:center;">User settings and preferences</h2>
			<div id="userPrefs" class="prefsDivs">
				<div id="changePW" class="prefsDivs">
					<h3>Request a change of password</h3>
					<form id="newPassForm" method="POST" action="" onsubmit="return false">
						need to do somehow
					</form>
				</div>
				<div id="updateEmail" class="prefsDivs">
					<!--<form method="post" action="">
						<input type="text" id="newEmail1" class="input_" placeholder="Type new email"><br>
						<input type="text" id="newEmail2" class="input_" name="newEmail" placeholder="Confirm new email">
					</form>-->
					<h3>Change email address</h3>
					<form id="newEmailForm" method="POST" action="" onsubmit="return false">
						<input type="text" required id ="newEmail1" class="input_" placeholder="New email">
						<input type="text" required id ="newEmail2" name="newEmail" class="input_" placeholder="Confirm new email">
						<button class="btn" onclick="validateNewEmail();">Submit</button><br>
						<p></p>
					</form>

				</div>
				<div id="changeLocation" class="prefsDivs">
					<h3>Change default location of farm</h3>
					<form id="newDefaultLocationForm" method="POST" action="" onsubmit="return false">
						<div id="newDefaultLocationMap" style="width:425px;height:220px;" ></div>
						<label>Lat: </label><input type="text" id="lblDefaultLat" name="newDefaultLat">
						<label>Long: </label><input type="text" id="lblDefaultLong" name="newDefaultLong"><br>
						<button class="btn" onclick="validateNewDefaultLocation()">Submit</button>
					</form><br>

				</div>
				<div id="changeAllTrapIntervals" class="prefsDivs">
				<h3>Select the upload inteval to apply to all traps</h3>
				<form id="newUploadForm" method="POST" action="" onsubmit="return false">
					<select id="newUploadInterval">
						<option value="none">(--Select upload interval--)</option>
						<option value="Everyhour">Every hour</option>
						<option value="fiveperday">Five times a day</option>
						<option value="threeperday">Three times a day</option>
						<option value="onceperday">Once a day</option>
					</select>
					<button class="btn" onclick="validateNewUpload();">Submit</button><br><br>
				</form>

				</div>
				<div id="changeSensingInterval" class="prefsDivs">
					<h3>Select the environment sensing inteval to apply to all traps</h3>
					<form id="newSensing" method="POST" action="" onsubmit="return false">
						<select id="newSensingInterval">
							<option value="none">(--Select upload interval--)</option>
							<option value="Everyhour">Every hour</option>
							<option value="fiveperday">Five times a day</option>
							<option value="threeperday">Three times a day</option>
							<option value="onceperday">Once a day</option>
						</select>
						<button class="btn" onclick="">Submit</button><br><br>
					</form>

				</div>
				<div id="displayTrapSettings" class="prefsDivs">
					<h3>Select the options to display on the trap</h3>
					NOT SURE IF THIS IS POSSIBLE CURRENTLY :)
				</div>
			</div>
		</div>

		</div>
        <div id="Traps" class="tabcontent">
        <!-- <p> Welcome <?php echo $_SESSION['fullname']; ?>. This is an overview of all the registered traps in your name<p><br> -->
        <button id="trapAddButton" class="buttons">Add Trap </button><br>
		<!--<input type="text" id="userlat">-->
        <label id="trapNo" style="color:white; float:right;padding:0;margin:0;"></label><br>
        <select style="float:right;" id="sortDropdown">
			<option selected disabled>Sort/Filter Traps by (choose option)</option>
			<option value="numOfMoths">Number of moths</option>
			<option value="Battery">Battery %</option>
			<option value="Temp">Temp</option>
        </select><br><br>
		<button id="mapofTrapsClient">Map of all traps</button>
			<div id="allTrapsMapModal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" style="text-align:left;">Add Another Trap</h4>
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

						</div>
						<div class="modal-body">
								<p>All traps</p>
								<div id="allTrapsGoogleMap" style="width:425px;height:220px;"></div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
			<div id="addTrapModal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" style="text-align:left;">Add Another Trap</h4>
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

						</div>
						<div class="modal-body">
							<form method="POST" action="addTrap.php" id="trapForm" onKeyPress="enterAddTrap(event, this)">
								Trap Group: <input type="text" required id="addTraptype" name="type"><br>
								Token: <input type="text" required  id="addTraphardware" name="token"><br>
								Upload Interval: <!--<input type="text" id="editUpload"><br>-->
								<select id="Trap_upload_interval"  required name="upload_interval">
									<option value="Everyhour">Every hour</option>
									<option value="fiveperday">Five times a day</option>
									<option value="threeperday">Three times a day</option>
									<option value="onceperday">Once a day</option>
								</select><br>
								<p>Please select the location of the trap you want to add below</p>
								<div id="googleMap" style="width:425px;height:220px;"></div>

								<script>

								</script>
<!--
								<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-INs4-fin3CKhBWpuSq0bTPeLKgq_YjU&callback=myMap" type="text/javascript"></script>
-->
								<label>Lat: </label><input type="text"  required id="lblLat2" name="trapLat">
								<label>Long: </label><input type="text"  required id="lblLong2" name="trapLong"><br>


							</form>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							<input type="submit" class="btn btn-primary" value="Add Trap" form="trapForm" id="addTrapButton">
						</div>
					</div>
				</div>
			</div>
		<div id="editTrapModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
					<h4 class="modal-title">Edit Trap</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						
					</div>
					<div class="modal-body">
						<form method="POST" action="editTrap.php" id="trapEditForm" onKeyPress="enterEditTrap(event, this)">
						<input type="text" hidden id="Tid" name="device_id">
						Trap Group: <input type="text"  required id="editType" name="type"><br>
						Description: <input type="text"  required id="editDescription" name="description" maxlength="12"><br>
						Upload Interval: <!--<input type="text" id="editUpload"><br>-->
						<select id="upload_interval" name="upload_interval">
								<option value="Everyhour">Every hour</option>
								<option value="fiveperday">Five times a day</option>
								<option value="threeperday">Three times a day</option>
								<option value="onceperday">Once a day</option>
						</select><br>
						Humidity and Temprature interval: 
						<select>
							<option value="Everyhour">Every hour</option>
							<option value="Twiceperday">Twice per day</option>
							<option value="Onceperday">Once per day</option>
						</select>
						<p><b>If you want to change to location of the trap you can do so below, otherwise leave blank</b></p>
						<div id="editMap" style="width:425px;height:220px;"></div>
						<!--<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-INs4-fin3CKhBWpuSq0bTPeLKgq_YjU&callback=myMap3" type="text/javascript"></script>-->
						<label>Lat: </label><input type="text"   id="lblLat" name="editTrapLat">
						<label>Long: </label><input type="text"   id="lblLong" name="editTrapLong"><br>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						<input type="submit" class="btn btn-primary" value="Save Changes" form="trapEditForm" id="editTrapButton">

					</div>
				</div>
			</div>
		</div>
			<div id="showMoreModal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title">Additional Information</h4>
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						</div>
						<div class="modal-body">
							Token: <input type="text" disabled id="showToken" ><br>
							Description: <input type="text" disabled id="showDescription"><br>
							Trap Group: <input type="text" disabled id="showTrapGroup"><br>
							Upload Interval: <input type="text" disabled id="showUpload"><br>
							Caught: <input type="text" disabled id="showCaught"><br>
							Battery Percentage: <input type="text" disabled id="showBattery"><br>
							Signal Strength: <input type="text" disabled id="showSignal"><br>
							Last Updated: <input type="text" disabled id="showLastUpdate"><label id="lastUpdateError" style="color:red"></label><br>
							Available Data: <input type="text" disabled id="showData"><br>
							lat: <input type="text" disabled id="showLat"><br>
							Long: <input type="text" disabled id="showLong">
							<div id="showTrapLocationMap" style="width:425px;height:220px;"></div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

						</div>
					</div>
				</div>
			</div>

			<div id="trapsDisplay"> <!-- traps will be displayed in here -->

			</div>
		</div>
		<div id="Graphs" class="tabcontent">
			<div id="MothsCaughtColumn">FusionCharts will render here</div>
			<select id="mothsPerDay" onchange="mothsPerDaySelect()">
				<option value="allTime">All</option>
				<option value="perMonth">Last Month</option>
				<option value="per3Month">Last 3 Months</option>
				<option value="per6Month">Last 6 Months</option>
				<option value="perYear">Last Year</option>
				<option value="per3Year">Last Three Years</option>
			</select>
			<div id="lineperday"></div> <br>
			<select id="tempPerDay" onchange="tempPerDaySelect()">
				<option value="allTime">All</option>
				<option value="perMonth">Last Month</option>
				<option value="per3Month">Last 3 Months</option>
				<option value="per6Month">Last 6 Months</option>
				<option value="perYear">Last Year</option>
				<option value="per3Year">Last Three Years</option>
			</select>
			<div id="tempPerDayChart">FusionCharts will render here</div>
		</div>
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-INs4-fin3CKhBWpuSq0bTPeLKgq_YjU&callback=init" type="text/javascript"></script>
		<script>
			function sort(){
				tinysort('#trapsDisplay > div',{attr: 'name'});

			}
			var markers =[];
		function showTrapMap(name,lat,long) {
            console.log(lat);
            if (typeof lat === 'undefined') {
                // the variable is defined
            }
            else {
                var allTrapLocations = [
                    [name, lat, long]
                ];//to hold trap locations for user
                //alert(userObject.latitude);
                var map = new google.maps.Map(document.getElementById('showTrapLocationMap'), {
                    zoom: 19,
                    center: new google.maps.LatLng(lat, long),
                    mapTypeId: google.maps.MapTypeId.SATELLITE
                });

                var infowindow = new google.maps.InfoWindow();

                var marker, i;

                for (i = 0; i < allTrapLocations.length; i++) {
                    marker = new google.maps.Marker({
                        position: new google.maps.LatLng(allTrapLocations[i][1], allTrapLocations[i][2]),
                        map: map
                    });

                    google.maps.event.addListener(marker, 'click', (function (marker, i) {
                        return function () {
                            infowindow.setContent(allTrapLocations[i][0]);
                            infowindow.open(map, marker);
                        }
                    })(marker, i));
                }
            }

        }
            function myMap2(lat,long) {
                var mapProp= {
                    center:new google.maps.LatLng(lat,long),
                    zoom:13,
                };
                map2=new google.maps.Map(document.getElementById("editMap"),mapProp);
                var allTrapLocation = [
                    [lat, long]
                ];
                google.maps.event.addListener(map2, 'click', function(event) {
                    //myLat = event.latLng.lat();
                    //myLong = event.LatLng.lng();
                    //alert(myLat);
                    document.getElementById("lblLat").value = event.latLng.lat();
                    myLat = document.getElementById("lblLat").innerHTML;
                    document.getElementById("lblLong").value = event.latLng.lng();
                    myLong = document.getElementById("lblLong").innerHTML;
                });
                //alert(document.getElementById("lblLat").value);
                //for (i = 0; i < allTrapLocation.length; i++) {{
                //}
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(lat, long),
                        map: map2
                    });
                //}

                map2.addListener('click', function(e) {
                    //myLong = e.;
                    //alert("ok: " + myLong);
                    placeMarker(e.latLng, map2);
                });
                var marker;
                function placeMarker(position, map) {
                    if (marker && marker.setMap) {
                        marker.setMap(null);
                    }
                    marker = new google.maps.Marker({
                        position: position,
                        map: map
                    });
                    map.panTo(position);
                }
            }
        //initiate the google maps in the add trap and edit trap divs - so that you can display 2 on 1 html page
        function init(){
			var userLat, userLong;
            var xhrr = new XMLHttpRequest();
            xhrr.onreadystatechange = function() {
                if (xhrr.readyState == XMLHttpRequest.DONE) {
                    //console.log(xhrr.responseText);
                    testUserDetails = JSON.parse(xhrr.responseText);

                }
            }
            xhrr.open('GET', 'user_details.php', false);
            xhrr.send(null);
            userLat = testUserDetails[2];
            userLong = testUserDetails[3];

            myMap();
            myMap2();
            newDefaultLocation();
            function myMap() {
                //myMap2();
                //
                // allTraps();
                var mapProp= {
                    center:new google.maps.LatLng(userLat,userLong),
                    zoom:13,
                };
                var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);

                google.maps.event.addListener(map, 'click', function(event) {
                    //myLat = event.latLng.lat();
                    //myLong = event.LatLng.lng();
                    //alert(myLat);
                    document.getElementById("lblLat2").value = event.latLng.lat();
                    myLat = document.getElementById("lblLat2").innerHTML;
                    document.getElementById("lblLong2").value = event.latLng.lng();
                    myLong = document.getElementById("lblLong2").innerHTML;
                });
                map.addListener('click', function(e) {
                    placeMarker(e.latLng, map);
                });
                var marker;
                function placeMarker(position, map) {
                    if (marker && marker.setMap) {
                        marker.setMap(null);
                    }
                    marker = new google.maps.Marker({
                        position: position,
                        map: map
                    });
                    map.panTo(position);
                }
            }
            function newDefaultLocation(){

                var mapProp= {
                    center:new google.maps.LatLng(userLat,userLong),//userObject.latitude,userObject.longitude),
                    zoom:13,
                };
                var map3=new google.maps.Map(document.getElementById("newDefaultLocationMap"),mapProp);
                document.getElementById("lblDefaultLat").value = userLat;
                document.getElementById("lblDefaultLong").value = userLat;
                google.maps.event.addListener(map3, 'click', function(event) {
                    //myLat = event.latLng.lat();
                    //myLong = event.LatLng.lng();
                    //alert(myLat);
                    document.getElementById("lblDefaultLat").value = event.latLng.lat();
                    myLat = document.getElementById("lblDefaultLat").innerHTML;
                    document.getElementById("lblDefaultLong").value = event.latLng.lng();
                    myLong = document.getElementById("lblDefaultLong").innerHTML;
                });
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(userLat, userLong),
                    map: map3
                });
                map3.addListener('click', function(e) {
                    //myLong = e.;
                    //alert("ok: " + myLong);
					//alert(e.latLng); (213123, 213123)
                    placeMarker(e.latLng, map3);
                });
                var marker;
                function placeMarker(position, map) {
                    if (marker && marker.setMap) {
                        marker.setMap(null);
                    }
                    marker = new google.maps.Marker({
                        position: position,
                        map: map
                    });
                    map.panTo(position);
                }
                //var string = userLat + ", " + userLong;
                //alert(string);
                //placeMarker(string,map3);
			}

            allTraps();
        }
	</script>
    </body>
</html>