<!DOCTYPE html>
<html lang="en">
<head>
<title>Settings</title>
<link rel="stylesheet" type="text/css" href="settings.css">
    <link rel="stylesheet" href="bootstrap-4.0.0-dist/css/bootstrap.min.css">
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-INs4-fin3CKhBWpuSq0bTPeLKgq_YjU&callback=myGoogleMap" type="text/javascript"></script>
    <script src="jquery-3.2.1.js"></script>
    <script src="bootstrap-4.0.0-dist/js/bootstrap.min.js"></script>
    <script src="modalJS.js"></script>
		<script>
		var clientArr;
            $(document).ready(function(){
			
                $.get("getClients.php", function(dat, status){
                    console.log("Data: " + dat + "\nStatus: " + status);
                    if(status == "success"){
						clientArr = JSON.parse(dat);
						makeTable();
                    }
                });

                /*$('#logout').click(function(){

                });*/
            });
			var id;
			function makeTable(){
				var table = document.getElementById("myTable");//document.createElement("table");
				for(var i =0;i<clientArr.length;i++){
					var row = document.createElement("tr");
					var currentRow = table.rows[i];
					var createClickHandler = function(row){
						return function(){
							var cell = row.getElementsByTagName("td")[0];
							id = cell.innerHTML;
							//alert("id: " + id);
							document.getElementById("clientDeleteId").value = id;
						}
					}
					
					for(var j=0;j<clientArr[i].length;j++){
						var cell = document.createElement("td");
						cell.style.border = "1 px solid yellow";
						cell.textContent = clientArr[i][j];
						row.appendChild(cell);
					}
					table.appendChild(row);
					currentRow.onclick = createClickHandler(currentRow);
				}
				//table.style.border = "1 px solid black";
				//document.getElementById("displaySettings").appendChild(table);
			}
			function validateAddClient(){
				if(document.getElementById("fn").value == "" || document.getElementById("un").value == "" 
				|| document.getElementById("pw1").value=="" ||document.getElementById("pw2").value == "" 
				|| document.getElementById("lblLat2").value == ""
				|| document.getElementById("lblLong2").value == ""){
				alert("Please make sure all required fields are entered");
				}
				else if(document.getElementById("pw1").value != document.getElementById("pw2").value){
					alert("The passwords entered does not match");
				}
				else{
				document.getElementById("clientForm").submit();
				}
			}
			function init(){
			    myGoogleMap();
			}
			</script>
	</head>
	<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="main.html">Erbium Insect Tracker</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">

                <li class="nav-item">
                    <a class="nav-link" href="contactus.html">contact us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="viewClients.php">Admin</a>
                </li>
            </ul>
            <div class="dropdown-menu" aria-labelledby="navDropDownLink">
                <a class="dropdown-item" href="#">Preferences</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Logout</a>
            </div>

        </div>
    </nav>

		<div id="addClient" style="border:3px solid black;color:white; width: 700px; margin: 0 auto; background-color:rgba(0, 0, 0, 0.5);padding:20px;">
			<h2 style="text-align:center;">Add client details below</h2>
			<div id="addClientForm" style="margin:auto;">
				<form method= "POST" onsubmit="return false" id="clientForm" action="addClient.php">
					<input type="text" placeholder="FullName" name="fullname" id="fn"><br><br>
					<input type="text" placeholder="Username" name="username" id="un"><br><br>
					<input type="password" placeholder="Password" name="password" id="pw1"><br><br>
					<input type="password" placeholder="Confirm Password" id="pw2"><br><br>
					<p>Select the location of the client</p>
					<div id="Map" style="width:425px;height:220px;"></div>

                <script>
				var myLat;
				var myLong;
				function myGoogleMap() {
                    var mapProp= {
                        center:new google.maps.LatLng(-25.755417,28.230767),
                        zoom:13,
                    };
                    var map=new google.maps.Map(document.getElementById("Map"),mapProp);

                    google.maps.event.addListener(map, 'click', function(event) {
                        //myLat = event.latLng.lat();
                        //myLong = event.LatLng.lng();
                        //alert(myLat);
                        document.getElementById("lblLat2").value = event.latLng.lat();
                        myLat = document.getElementById("lblLat2").innerHTML;
                        document.getElementById("lblLong2").value = event.latLng.lng();
                        myLong = document.getElementById("lblLong2").innerHTML;
                    });
                    map.addListener('click', function(e) {
                        //myLong = e.;
                        //alert("ok: " + myLong);
                        placeMarker(e.latLng, map);
                    });

                }
                var marker;
                function placeMarker(position, map) {
                    if (marker && marker.setMap) {
                        marker.setMap(null);
                    }
                    marker = new google.maps.Marker({
                        position: position,
                        map: map
                    });
                    map.panTo(position);
                }
						
                </script>


					<label>Lat: </label><input type="text" id="lblLat2" name="clientLat">
					<label>Long: </label><input type="text" id="lblLong2" name="clientLong"><br>
					<button onclick="validateAddClient()">Add Client</button>
				</form>
			</div>
	
</body>
</html>