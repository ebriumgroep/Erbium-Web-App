<!DOCTYPE html>
<html lang="en">
<head>
<title>Settings</title>
<link rel="stylesheet" type="text/css" href="Erbuim_Main.css">
        <link rel="stylesheet" href="bootstrap-4.0.0-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="contactus.css">
        <script src="jquery-3.2.1.js"></script>
        <script src="bootstrap-4.0.0-dist/js/bootstrap.min.js"></script>
		<script>
		var clientArr;
            $(document).ready(function(){
			
                $.get("getClients.php", function(dat, status){
                    console.log("Data: " + dat + "\nStatus: " + status);
                    if(status == "success"){
						clientArr = JSON.parse(dat);
						makeTable();
                    }
                });

                /*$('#logout').click(function(){

                });*/
            });
			var id;
			function makeTable(){
				var table = document.getElementById("myTable");//document.createElement("table");
				for(var i =0;i<clientArr.length;i++){
					var row = document.createElement("tr");
					var currentRow = table.rows[i];
					var createClickHandler = function(row){
						return function(){
							var cell = row.getElementsByTagName("td")[0];
							id = cell.innerHTML;
							//alert("id: " + id);
							document.getElementById("clientDeleteId").value = id;
						}
					}
					
					for(var j=0;j<clientArr[i].length;j++){
						var cell = document.createElement("td");
						cell.style.border = "1 px solid yellow";
						cell.textContent = clientArr[i][j];
						row.appendChild(cell);
					}
					table.appendChild(row);
					currentRow.onclick = createClickHandler(currentRow);
				}
				//table.style.border = "1 px solid black";
				//document.getElementById("displaySettings").appendChild(table);
			}
			function deleteClient(){
				if(document.getElementById("clientDeleteId").value == ""){
				alert("Please select a client first");
				}
				else{
					if(confirm("Are you sure you want to delete client no " + id + "?")){
						document.getElementById("deleteForm").submit();
					}
					else{
						return false;
					}
						
				}
			}
			function validateAddClient(){
				if(document.getElementById("fn").value == "" || document.getElementById("un").value == "" 
				|| document.getElementById("pw1").value=="" ||document.getElementById("pw2").value == "" 
				|| document.getElementById("lblLat2").value == ""
				|| document.getElementById("lblLong2").value == ""){
				alert("Please make sure all required fields are entered");
				}
				else if(document.getElementById("pw1").value != document.getElementById("pw2").value){
					alert("The passwords entered does not match");
				}
				else{
				document.getElementById("clientForm").submit();
				}
			}
			</script>
	</head>
	<body>
		<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <!-- Brand/logo -->
            <a class="navbar-brand" href="main.html">Erbium Insect Tracker</a>

            <!-- Links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="settings.html">Settings</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="contactus.html">Contact us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="logout.php">Logout</a>
                </li>
            </ul>
        </nav>
	
		<div id="displaySettings" style="overflow-y:scroll;border:3px solid black;max-width: 700px;max-height:400px;margin: 0 auto;background-color:rgba(0, 0, 0, 0.5);">
		<h1 style="text-align:center;color:white;">Client information </h1>
			<table border="1" id="myTable" style="background-color:white;">
			<tr>
				<th>ID</th>
				<th>Fullname</th>
				<th>Username</th>
				<th>Lat</th>
				<th>Long</th>
			</tr>
			</table>
			<form method="POST" onsubmit="return false;" id="deleteForm">
				<label style="color:white;">Selected Client:  </label><input type="text" name="clientid" id="clientDeleteId" style="color:white;width:30px;background-color:rgba(0,0,0,0);outline:none;">
				<button onclick="deleteClient()">Delete a client</button>
			</form>
		</div>
		<div id="addClient" style="border:3px solid black;color:white; width: 700px; margin: 0 auto; background-color:rgba(0, 0, 0, 0.5);padding:20px;">
			<h2 style="text-align:center;">Add client details below</h2>
			<div id="addClientForm" style="margin:auto;">
				<form method= "POST" onsubmit="return false" id="clientForm" action="addClient.php">
					<input type="text" placeholder="FullName" name="fullname" id="fn"><br><br>
					<input type="text" placeholder="Username" name="username" id="un"><br><br>
					<input type="password" placeholder="Password" name="password" id="pw1"><br><br>
					<input type="password" placeholder="Confirm Password" id="pw2"><br><br>
					<p>Select the location of the client</p>
					<div id="Map" style="width:425px;height:220px;"></div>

                <script>
				var myLat;
				var myLong;
				function myMap() {
					var mapProp= {
						center:new google.maps.LatLng(-25.755417,28.230767),
						zoom:13,
					};
					var map=new google.maps.Map(document.getElementById("Map"),mapProp);

					google.maps.event.addListener(map, 'click', function(event) {
						//myLat = event.latLng.lat();
						//myLong = event.LatLng.lng();
						//alert(myLat);
						document.getElementById("lblLat2").value = event.latLng.lat();
						myLat = document.getElementById("lblLat2").innerHTML;
						document.getElementById("lblLong2").value = event.latLng.lng();
						myLong = document.getElementById("lblLong2").innerHTML;
					});
					map.addListener('click', function(e) {
						//myLong = e.;
						//alert("ok: " + myLong);
						placeMarker(e.latLng, map);	
					});

				}
				var marker;
				function placeMarker(position, map) {
					if (marker && marker.setMap) {
						marker.setMap(null);
					}
					marker = new google.maps.Marker({
						position: position,
						map: map
					});
					map.panTo(position);
				}
						
                </script>

					<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-INs4-fin3CKhBWpuSq0bTPeLKgq_YjU&callback=myMap" type="text/javascript"></script>
					<label>Lat: </label><input type="text" id="lblLat2" name="clientLat">
					<label>Long: </label><input type="text" id="lblLong2" name="clientLong"><br>
					<button onclick="validateAddClient()">Add Client</button>
				</form>
			</div>
	
</body>
</html>